<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>STACJA 4</title>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="icon" href="bhl.jpg" type="image/jpeg">

  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%;
    }
    body {
      font-family: 'Share Tech Mono', monospace;
      background-color: #0a0a0a;
      color: #00ffcc;
      overflow-x: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .container {
      width: 95%;
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: rgba(0, 0, 0, 0.75);
      border: 2px solid #00ffcc;
      border-radius: 12px;
      text-align: center;
    }
    h1 { color: #ff0055; font-size: 1.8rem; margin: 10px 0; }
    canvas {
      display: block;
      width: 100%;
      height: auto;
      background: linear-gradient(180deg,#000 0%, #050505 100%);
      border: 2px solid #00ffcc;
      border-radius: 8px;
      margin: 10px auto;
    }
    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    button {
      background: none;
      border: 2px solid #00ffcc;
      color: #00ffcc;
      padding: 8px 16px;
      font-size: 1rem;
      cursor: pointer;
      font-weight: bold;
      text-transform: uppercase;
      border-radius: 6px;
    }
    button:hover {
      background-color: #00ffcc;
      color: #000;
    }
    .overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(3px);
    }
    .card {
      background: #000;
      border: 2px solid #00ffcc;
      padding: 20px;
      border-radius: 12px;
      max-width: 90%;
      width: 400px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Go, T-Rex! Go!</h1>
    <div class="hud">
      <div>Wynik: <span id="score">0</span></div>
      <div>Życia: <span id="lives">3</span></div>
      <div class="goal">Cel: 50 pkt</div>
    </div>
    <canvas id="game"></canvas>
    <div class="controls">
      <button id="startBtn">START</button>
      <button id="resetBtn">RESET</button>
    </div>
    <p>Sterowanie: <strong>Spacja / Dotknięcie</strong> = skok</p>
  </div>

  <div id="solutionOverlay" class="overlay">
    <div class="card">
      <h2 id="endMessage"></h2>
      <pre id="secret"></pre>
      <button id="playAgain">Zagraj ponownie</button>
      <button id="finalScreen" style="display:none">EKRAN FINAŁOWY</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const overlay = document.getElementById('solutionOverlay');
    const playAgain = document.getElementById('playAgain');
    const finalScreen = document.getElementById('finalScreen');
    const endMessage = document.getElementById('endMessage');
    const secret = document.getElementById('secret');

    // Dynamiczne dopasowanie canvas
    function resizeCanvas() {
      canvas.width = canvas.offsetWidth;
      canvas.height = 160;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    const CONFIG = {
      goalPoints: 50,
      speed: 3,
      gravity: 0.9,
      jumpPower: -16,
      playerW: 40,
      playerH: 35
    };

    let running = false, score=0, lives=3;
    let obstacles = [], collectibles = [];
    let player = {x:60, y:0, vy:0, w:CONFIG.playerW, h:CONFIG.playerH, onGround:true};
    player.y = canvas.height - player.h - 16;

    let spawnTimer = 0;
    const sequence = ["B","#","L"];
    let seqIndex = 0;

    function resetGame() {
      running = false;
      score = 0;
      lives = 3;
      obstacles = [];
      collectibles = [];
      player.y = canvas.height - player.h - 16;
      player.vy = 0;
      player.onGround = true;
      scoreEl.textContent = score;
      livesEl.textContent = lives;
      overlay.style.display = 'none';
    }

    function startGame() {
      if (!running) {
        running = true;
        spawnTimer = performance.now();
        requestAnimationFrame(loop);
      }
    }

    function spawnEntity() {
      const now = performance.now();
      if (now - spawnTimer < 1000) return;
      spawnTimer = now;

      if (Math.random() < 0.5) {
        // collectible
        collectibles.push({
          x: canvas.width,
          y: canvas.height - 60 - Math.random()*40,
          w: 20, h: 20,
          symbol: sequence[seqIndex]
        });
        seqIndex = (seqIndex + 1) % sequence.length;
      } else {
        // obstacle
        const h = 30 + Math.random()*20;
        obstacles.push({
          x: canvas.width,
          y: canvas.height - h - 16,
          w: 20, h: h
        });
      }
    }

    function loop() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if (running) spawnEntity();

      // Draw obstacles
      for (let i=obstacles.length-1; i>=0; i--) {
        const ob = obstacles[i];
        ob.x -= CONFIG.speed;
        ctx.fillStyle = '#b45309';
        ctx.fillRect(ob.x, ob.y, ob.w, ob.h);
        if (collision(player, ob)) {
          obstacles.splice(i,1);
          lives--;
          livesEl.textContent = lives;
          if (lives <= 0) endGame(false);
        } else if (ob.x + ob.w < 0) {
          obstacles.splice(i,1);
        }
      }

      // Draw collectibles
      for (let i=collectibles.length-1; i>=0; i--) {
        const c = collectibles[i];
        c.x -= CONFIG.speed;
        ctx.fillStyle = '#f59e0b';
        ctx.fillRect(c.x,c.y,c.w,c.h);
        ctx.fillStyle = '#fff';
        ctx.font="16px Share Tech Mono";
        ctx.fillText(c.symbol, c.x+5, c.y+15);
        if (collision(player,c)) {
          collectibles.splice(i,1);
          score += 3;
          scoreEl.textContent = score;
          if (score >= CONFIG.goalPoints) endGame(true);
        } else if (c.x + c.w < 0) {
          collectibles.splice(i,1);
        }
      }

      // Player physics
      player.vy += CONFIG.gravity;
      player.y += player.vy;
      if (player.y >= canvas.height - player.h - 16) {
        player.y = canvas.height - player.h - 16;
        player.vy = 0;
        player.onGround = true;
      }

      ctx.fillStyle = '#9ae6b4';
      ctx.fillRect(player.x, player.y, player.w, player.h);

      if (running) requestAnimationFrame(loop);
    }

    function collision(a,b) {
      return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y;
    }

    function jump() {
      if (player.onGround) {
        player.vy = CONFIG.jumpPower;
        player.onGround = false;
      }
    }

    function endGame(win) {
      running = false;
      overlay.style.display = 'flex';
      endMessage.textContent = win ? "WYGRAŁEŚ!" : "PRZEGRAŁEŚ!";
      secret.textContent = win ? "KOD: 25" : "";
      finalScreen.style.display = win ? 'inline-block' : 'none';
    }

    // Event listeners
    window.addEventListener('keydown', e => {
      if (e.code === 'Space') {
        e.preventDefault();
        if (!running) startGame();
        jump();
      }
    });

    canvas.addEventListener('click', () => {
      if (!running) startGame();
      jump();
    });

    startBtn.addEventListener('click', startGame);
    resetBtn.addEventListener('click', resetGame);
    playAgain.addEventListener('click', () => { resetGame(); startGame(); });
    finalScreen.addEventListener('click', () => window.location.href = 'final.html');

    resetGame();
  </script>
</body>
</html>

